<a name="router" class="anchor"></a>
<h1>
  Router
</h1>
<p>
  Next up is the router. This is where our application actually starts to do some stuff via HTTP endpoints.
  The router of choice in the MEAN Stack is Express (the E in mEan). ExpressJS is a standard choice for most
  web-apps with a node powered backend. We'll need to install express and some other packages to get the code in this section running.
</p>
<pre class="code-snippet">
npm install --save express body-parser
npm install --save-dev @types/express @types/body-parser
</pre>


<h3>Getting started with Express</h3>
<p>
  In order to get started, we'll host a simple welcome file. First we create the router directory. In <code>src</code>,
</p>
<pre class="code-snippet">
mkdir router
cd router
mkdir endpoints
</pre>
<p>
  Then create the following files:
</p>
<amp-accordion>
  <section>
    <h5 class="file-label-two">backend/src/router/router.ts</h5>
    <pre class="code-snippet">{{> ./sections/router/router.ts.html}}</pre>
  </section>
  <section>
    <h5 class="file-label-two">backend/src/router/router.test.ts</h5>
    <pre class="code-snippet">{{> ./sections/router/router.test.ts.html}}</pre>
  </section>
  
  <section>
    <h5 class="file-label-two">backend/src/router/middleware.ts</h5>
    <pre class="code-snippet">{{> ./sections/router/middleware.ts.html}}</pre>
  </section>
  <section>
    <h5 class="file-label-two">backend/src/router/endpoints/welcome-html-router.ts</h5>
    <pre class="code-snippet">{{> ./sections/router/endpoints/welcome-html-router.ts.html}}</pre>
  </section>
  <section>
    <h5 class="file-label-two">backend/src/router/endpoints/welcome-html-router.test.ts</h5>
    <pre class="code-snippet">{{> ./sections/router/endpoints/welcome-html-router.test.ts.html}}</pre>
  </section>
</amp-accordion>

<p>
  We should be able to run <code>npm test</code> successfully now. So far, we didn't even bother to open the browser, but
  we're actually at a point where we could almost do so, since we now have our first endpoint. Before we do that, however, we're
  missing one more file: The <code>index.ts</code>. If you were to run <code>npm start</code>, it wouldn't have done
  anything but throw an error up until now. But this is going to change. At the <code>src</code> level of the backend, create the following
  file
</p>
<div class="file-label">backend/src/index.ts</div>
<pre class="code-snippet">{{> ./sections/router/index.ts.html}}</pre>
<p>
  This will enable us to finally get a running backend at port 3000 using the <code>npm start</code>
  command. After <code>npm start</code>, you can check the welcome file at
  <a href="http://localhost:3000/welcome" target="_blank">http://localhost:3000/welcome</a>.
</p>

<h3>Adding a generic CRUD endpoint</h3>
<p>
  Now to add some real functionality, next we're adding a CRUD (create, read, update, delete) router endpoint.
  This endpoint will actually write to- and retrieve from the database, leveraging the previously built
  database layer.
</p>

<amp-accordion>
  <section>
    <h5 class="file-label-two">backend/src/router/endpoints/simple-crud-router.ts</h5>
    <pre class="code-snippet">{{> ./sections/router/endpoints/simple-crud-router.ts.html}}</pre>
  </section>
  <section>
    <h5 class="file-label-two">backend/src/router/endpoints/simple-crud-router.test.ts</h5>
    <pre class="code-snippet">{{> ./sections/router/endpoints/simple-crud-router.test.ts.html}}</pre>
  </section>
</amp-accordion>

<p>
  In order to activate those routes, we also need to register them. To do so, open the <code>router.ts</code> file
  and insert the lines
</p>
<pre class="code-snippet">
//The simpleCrudRouter should stay last, since it covers quite a broad range of requests and if it's moved above
//it will steal away the endpoints of the more specific implementations
this.express.use('/api/v1/', simpleCrudRouter);
</pre>
<p>
  right after <code>this.express.use('/welcome', welcomeHtmlRouter);</code>. In case you're using an IDE you probably noticed by now:
  we also need to import the module. At the top of <code>router.ts</code>, put
</p>
<pre class="code-snippet">
import {simpleCrudRouter} from "./endpoints/simple-crud-router";
</pre>
<p>
  Now you should again have running tests (<code>npm test</code>).
</p>